<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="test.Forum.TopicsPage">
<Super>%UnitTest.TestCase</Super>
<TimeCreated>63824,73260.687253</TimeCreated>

<Method name="TestGetPages">
<Implementation><![CDATA[
	s html = ##class(%Stream.FileCharacter).%New()
	s sc = html.LinkToFile("D:\Clone\SQLRU\test\asset\topicspage.with.66pages.html")
	s pages = ##class(Forum.TopicsPage).GetPages( html )
	do $$$AssertEquals(pages,66,"Should extract pages count")
]]></Implementation>
</Method>

<Method name="TestUrl">
</Method>

<Method name="TestParseMethods">
<Implementation><![CDATA[
	#define TP ##class(Forum.TopicsPage)
	
	s topic = ##class(%Stream.FileCharacter).%New()
	s sc = topic.LinkToFile("D:\Clone\SQLRU\test\asset\topic.with.mark.and.author-link.and.with.a.pages.html")
	s topicW = topic.Read()
	s sc = topic.LinkToFile("D:\Clone\SQLRU\test\asset\topic.without.mark.and.author-link.and.with.17.pages.html")
	s topicWO = topic.Read()
	k topic
	
	s topicW( "Mark" ) = $$$TP.ParseMark( topicW ) ;"Важно: "
	s topicWO( "Mark" ) = $$$TP.ParseMark( topicWO ) ;""
	
	s topicW( "ExtId" ) = $$$TP.ParseExtId( topicW ) ;1003258
	s topicWO( "ExtId" ) = $$$TP.ParseExtId( topicWO ) ;349188
	s topicW( "Views" ) = $$$TP.ParseViews( topicW ) ;7599
	s topicW( "Answers" ) = $$$TP.ParseAnswers( topicW ) ;12
	s topicW( "Updated" ) = $$$TP.ParseUpdated( topicW ) ;7 сен 15, 12:59
	s topicW( "Type" ) = $$$TP.ParseType( topicW ) ;"message"
	s topicW( "Name" ) = $$$TP.ParseName( topicW ) ;"Взаимодействие с InterSystems"

	s sc = $$$TP.ParseAuthor( topicW, .author ) 
	m topicW( "Author") = author ; topicW( "Author" ) = "Шваров Евгений", topicW( "Author", "ExtId" ) = 164999 
	k author
	s sc = $$$TP.ParseAuthor( topicWO, .author ) 
	m topicWO( "Author") = author ; topicWO( "Author" ) = "Sergey Gladilin"
	k author

	s topicW( "PagesAmount" ) = "a"
	if $f(topicW,"<!--begin case_ismultipage-->") {
		s topicW( "PagesAmount" ) = $$$TP.ParsePagesAmount( topicW , topicW("ExtId")) ;"a"
	}
	s topicWO( "PagesAmount" ) = "a"
	if $f(topicWO,"<!--begin case_ismultipage-->") {
		s topicWO( "PagesAmount" ) = $$$TP.ParsePagesAmount( topicWO , topicWO("ExtId")) ;17
	}
	
	do $$$AssertEquals(topicW( "Mark" ),"Важно:","Should extract mark of name of topic")
	do $$$AssertEquals(topicWO( "Mark" ),"","Should extract mark of name of topic")
	do $$$AssertEquals(topicW( "ExtId" ),1003258,"Should extract ExtId of topic")
	do $$$AssertEquals(topicWO( "ExtId" ),349188,"Should extract ExtId of topic")
	do $$$AssertEquals(topicW( "Views" ),7599,"Should extract number of views of topic")
	do $$$AssertEquals(topicW( "Answers" ),12,"Should extract number of answers of topic")
	do $$$AssertEquals(topicW( "Updated" ),$zdt("63802,46740",3),"Should extract date of last update of topic") ;$zdt("63802,46740",3)=2015-09-07 12:59:00
	do $$$AssertEquals(topicW( "Type" ),"message","Should extract mark of name of topic")
	do $$$AssertEquals(topicW( "Name" ),"Взаимодействие с InterSystems","Should extract name of topic")
	do $$$AssertEquals(topicW( "Author" ), "Шваров Евгений","Should extract author of topic")
	do $$$AssertEquals(topicW( "Author", "ExtId" ), 164999,"Should extract ExtId of author of topic")
	do $$$AssertEquals(topicWO( "Author" ), "Sergey Gladilin","Should extract author of topic")
	do $$$AssertNotTrue($d(topicWO( "Author", "ExtId" )),"Shouldn't extract ExtId of author of topic")
	do $$$AssertEquals(topicW( "PagesAmount" ), "a","Should extract amount of pages of topic = ""a""")
	do $$$AssertEquals(topicWO( "PagesAmount" ), 17,"Should extract amount of pages of topic = 17")
]]></Implementation>
</Method>
</Class>
</Export>
